<polymer-element name="duel-detailed-card" attributes="duelId isLive scoreLog atTime context leftPlayerScore olderDuelId newerDuelId map mode hasDemo leftPlayerId leftPlayerName rightPlayerScore rightPlayerId rightPlayerName leftPlayerHistoryJson rightPlayerHistoryJson">
    <template>
        <style scoped>

            section.duel {
                width:100%;
                margin:0 auto;
                margin-top:2em;
            }
            .duel header {
                font-size:2em;
            }
            .duel header * {
                font-size: inherit;
                margin: 0;
            }

            .duel p.name a {
                color:inherit;
            }
            .duel p.name a:hover {
                color:#c7325f;
                -webkit-transition: color 0.4s;
            }

            .player-profile-name {
                font-size:2.4em;
            }
            .duel p.score {
                font-size:6em;
                color:#fcfbe3;
            }
            .duel section.score {
                display:inline-block;
                width:49%;
            }
            .duel p.name {
                font-size:3em;
            }
            .duel p {
                margin:0;
            }
            .duel svg {
                transform:scale(1.6);
                margin-top:4em;
                margin-bottom:4em;
            }
            .duel .score.score-right .name a {
                color:#f0d8d9;
            }

        </style>

    <section class="duel">

        <header>
            <h3 class="mode-map">{{mode}} @ {{map}}</h3>
            <h2 class="date-time">
            <template if="{{isLive}}">
                <span>started <time is="relative-time" datetime="{{atTime}}">{{atTime}}</time></span>
            </template>
            <template if="{{!isLive}}">
                <time is="relative-time" datetime="{{atTime}}">{{atTime}}</time>
            </template>
            </h2>
        </header>
        <section class="score score-left">
            <p class="score">{{leftPlayerScore}}</p>
            <p class="name">
                <template if="{{leftPlayerId}}">
                    <a href="/player/{{leftPlayerId}}/">{{leftPlayerName}}</a>
                </template>
                <template if="{{!leftPlayerId}}">
                    <a href="/player/?nickname={{leftPlayerName}}">{{leftPlayerName}}</a>
                </template>
            </p>
        </section>
        <section class="score score-right">
            <p class="score">{{rightPlayerScore}}</p>
            <p class="name">
                <template if="{{rightPlayerId}}">
                    <a href="/player/{{rightPlayerId}}/">{{rightPlayerName}}</a>
                </template>
                <template if="{{!rightPlayerId}}">
                    <a href="/player/?nickname={{rightPlayerName}}">{{rightPlayerName}}</a>
                </template>
            </p>
        </section>
        <template if="{{leftScorePath && rightScorePath}}">
        <svg version="1.1" height="139" width="240">
            <g transform="translate(3,1.6378174)">
                <rect y="158.36218" x="-297" height="81" width="137" id="rect2987" style="fill:#d8f0f0;fill-opacity:1;stroke:none"/>
                <rect y="-1.6378174" x="-1" height="140" width="240" id="rect4492" style="fill:#303048;fill-opacity:1;stroke:none"/>
                <g transform="translate(-60,0)">
                    <path d="{{leftScorePath}}" style="fill:none;stroke:#d8f0f0;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" id="path3757"/>
                    <path d="{{rightScorePath}}" style="fill:none;stroke:#f0d8d9;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0"/>
                </g>
                <g id="background">
                    <path style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0" d="m 23,109.36218 207,0" id="path3761"/>
                    <path d="m 23,127.36218 207,0" style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0"/>
                    <path d="m 23,89.36218 207,0" style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0"/>
                    <path style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0" d="m 23,69.36218 207,0" id="path3767"/>
                    <path id="path3769" d="m 23,49.36218 207,0" style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0"/>
                    <path style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0" d="m 23,29.36218 207,0" id="path3771"/>
                    <path id="path3773" d="m 23,9.36218 207,0" style="fill:#d8f0f0;fill-opacity:1;stroke:#fcfbe3;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1, 3;stroke-dashoffset:0"/>
                    <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;line-height:160.00000238%;letter-spacing:0px;word-spacing:0px;fill:#fcfbe3;fill-opacity:1;stroke:none;font-family:Sans" x="17.171875" y="14.362183" id="text3775"><tspan x="17.171875" y="14.362183" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans">{{texts[6]}}</tspan><tspan x="17.171875" y="33.562183" id="tspan3789" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans">{{texts[5]}}</tspan><tspan x="17.171875" y="52.762184" id="tspan3787" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans">{{texts[4]}}</tspan><tspan x="17.171875" y="71.962181" id="tspan3785" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans">{{texts[3]}}</tspan><tspan x="17.171875" y="91.162186" id="tspan3783" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans">{{texts[2]}}</tspan><tspan x="17.171875" y="110.36218" id="tspan3781" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans">{{texts[1]}}</tspan><tspan style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans" id="tspan3779" y="129.56218" x="17.171875">{{texts[0]}}</tspan><tspan x="17.171875" y="129.56218" id="tspan3779" style="font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:160.00000238%;text-anchor:end;fill:#fcfbe3;fill-opacity:1;font-family:Open Sans;-inkscape-font-specification:Open Sans"></tspan>
</text>
                </g>
                <text id="text3791" y="216.36218" x="154" style="font-size:40px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan y="216.36218" x="154" id="tspan3793"/>
</text>
            </g>
        </svg>
        </template>

<!--        <template if="{{hasDemo}}">
            <p><a href="{{context ||'/'}}duel/{{duelId}}/{{duelId}}.dmo">Download demo</a></p>
        </template>-->
    </section>
    </template>
    <script>
        Polymer("duel-detailed-card", {
            scoreLogChanged: function(_, v) {
                var scoreLog = JSON.parse(v);
                var maxScore = Math.max.apply(null, scoreLog[0].concat(scoreLog[1]).filter(function(x) { return x != '-'; }));
                var stepSize = Math.ceil(maxScore / 6);
                var ys = [0,1,2,3,4,5,6];
                var xs = [0,1,2,3,4,5,6,7,8,9,10];
                var texts = ys.map(function(y) { return stepSize * y; });
                var maxChartScore = stepSize * 6;
                var by = 127.36218;
                var ty = 10.36218;
                var rx = 287;
                var lx = 84;
                var duration = Math.max(scoreLog[0].length, scoreLog[1].length) - 1;
                var stuff = scoreLog.map(
                    function(sl) {
                        var items = xs.filter(function(t) { return sl[t] != '-'; }).map(function(t) {
                            var x = lx +  t * ((rx - lx) / duration);
                            if ( t == 0 ) { x = lx; }
                            var score = sl[t];
                            var y = by + ((score / maxChartScore) * (ty-by));
                            return "L " + x + "," + y;
                        });
                        return "M " + lx + "," + by + " " + items.join(" ")
                    }
                )
                this.leftScorePath = stuff[0];
                this.rightScorePath = stuff[1];
                this.texts = texts;
            }
        })
    </script>
</polymer-element>